inputSet:
  identifier: "prephenv"
  name: "prephenv"
  orgIdentifier: "default"
  projectIdentifier: "tiger"
  pipeline:
    identifier: "zztestcanarydeployment"
    stages:
    - stage:
        identifier: "Canary_Deploy"
        type: "Deployment"
        spec:
          service:
            serviceInputs:
              serviceDefinition:
                type: "Kubernetes"
                spec:
                  artifacts:
                    primary:
                      primaryArtifactRef: "http-echo"
                      sources:
                      - identifier: "http-echo"
                        type: "DockerRegistry"
                        spec:
                          tag: "0.0.2-alpine"
          environment:
            environmentRef: "cdtooling2eksv2"
            infrastructureDefinitions:
            - identifier: "ephemeralenv"
              inputs:
                identifier: "ephemeralenv"
                type: "KubernetesDirect"
                spec:
                  namespace: "pr-<+trigger.prNumber>"
          execution:
            steps:
            - stepGroup:
                identifier: "Provision_Infrastructure"
                steps:
                - step:
                    identifier: "Terraform_Plan"
                    type: "TerraformPlan"
                    spec:
                      configuration:
                        configFiles:
                          store:
                            type: "Github"
                            spec:
                              branch: "main"
                        varFiles:
                        - varFile:
                            identifier: "env vars"
                            type: "Remote"
                            spec:
                              store:
                                type: "Github"
                                spec:
                                  branch: "main"
        variables:
        - name: "target_env"
          type: "String"
          value: "pr-<+trigger.prNumber>"
